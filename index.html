<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JioMart Invoice Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 10px;
      background: #f5f5f5;
      font-size: 16px;
    }
    .container {
      width: 80mm;
      margin: 0 auto;
      background: white;
      padding: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      font-size: 18px;
      line-height: 1.2;
      font-weight: bold;
      color: #000000;
    }

    .header p,
    .customer-details p,
    .order-details p,
    .bill-info p,
    .footer p,
    .ref-details p,
    .invoice-title p,
    .totals p,
    .gst-details p {
      margin: 0;
      padding: 0;
      font-size: 16px;
    }

    .logo-qr-top {
      text-align: center;
      margin: 0;
      padding: 0;
    }
    .logo-qr-top .logo-main,
    .logo-qr-top .logo-sub {
      width: 90%;
      max-width: 220px;
      margin: 0 auto 0;
      display: block;
    }
    .logo-qr-top canvas.qr {
      width: 120px !important;
      height: 120px !important;
      margin: 0 auto 0;
      padding: 0;
      display: block;
    }

    .header {
      margin: 0;
      padding: 0;
      text-align: left;
    }
    .header p { margin: 1px 0; font-size: 17px; }
    .separator { border: none; border-top: 1px dashed #ccc; margin: 5px 0; }
    .customer-details p, .order-details p, .bill-info p { margin: 1px 0; font-size: 17px; }

    .items-table { width: 100%; border-collapse: collapse; font-size: 17px; margin: 5px 0; }
    .items-table td { padding: 2px 4px; border-bottom: 1px solid #000; text-align: left; }
    .items-table .right { text-align: right; }

    .gst-table { width: 100%; border-collapse: collapse; font-size: 17px; }
    .gst-table td { padding: 2px; text-align: right; }
    .gst-table .left { text-align: left; }

    .footer { text-align: center; font-size: 17px; margin-top: 10px; }
    .qr-bottom { text-align: center; margin: 5px 0; }
    .qr-bottom canvas { width: 120px !important; height: 120px !important; }

    .print-btn {
      display: block;
      margin: 10px auto;
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 18px;
      border-radius: 5px;
    }
    .print-btn:hover {
      background: #0056b3;
    }

    input { width: 160px; font-size: 17px; border: 1px solid #ccc; font-family: inherit; margin: 2px 0; }
    .editable-value { display: inline-block; min-width: 160px; }
    .display-text { display: none; }

    .add-item {
      margin-bottom: 10px;
      text-align: center;
    }
    .add-item button {
      background: #28a745;
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 16px;
      margin-right: 5px;
    }
    .add-item button:hover {
      background: #218838;
    }
    
    .remove-item-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 3px 8px;
      cursor: pointer;
      border-radius: 3px;
      font-size: 12px;
      margin-left: 5px;
    }
    .remove-item-btn:hover {
      background: #c82333;
    }
    
    .item-actions {
      text-align: center;
      padding: 5px 0;
    }

    @media print {
      body { padding: 0; background: white; }
      .container { width: 80mm; box-shadow: none; margin: 0; padding: 5px; }
      .print-btn, input, .add-item, .remove-item-btn { display: none !important; }
      .editable-value { display: none !important; }
      .display-text { display: inline !important; border: none !important; background: transparent !important; }
      .item-row input { display: none !important; }
      .item-row .display-only { display: inline !important; }
      @page { size: 80mm auto; margin: 0; }
    }
  </style>
</head>
<body>
  <div class="container" id="invoice">
    <div class="logo-qr-top">
      <img src="logo1.png" alt="Main Logo" class="logo-main">
      <img src="logo2.png" alt="Second Logo" class="logo-sub">
      <canvas id="qr-top" class="qr"></canvas>
    </div>

    <div class="header">
      <p>Customer Care email-CS@jiomart.com</p>
      <p>RELIANCE SMART</p>
      <p>LG-001, DLF Mega Mall</p>
      <p>Customer Care toll free number- 1800 898 1222</p>
      <p>CIN No : U01100MH1999PLC120563</p>
      <p>GSTIN- 06AABCR1718E1ZT</p>
      <p>FSSAI Lic No -10817005000406</p>
      <p>Place of Supply & State code: 06 HR</p>
    </div>
    <hr class="separator">

    <div class="customer-details">
      <p>Customer GSTIN: URD</p>
      <p>Customer Details</p>
      <p><input type="text" class="editable-value" id="customer-name" value="Neeraj None" onchange="updateDisplay('customer-name')"><span class="display-text" id="customer-name-display"></span></p>
      <p>Phone: <input type="text" class="editable-value" id="phone" value="XXXXXXXXXX" onchange="updateDisplay('phone')"><span class="display-text" id="phone-display"></span></p>
      <p>Flat No: <input type="text" class="editable-value" id="flat-no" value="Mg road metro s" onchange="updateDisplay('flat-no')"><span class="display-text" id="flat-no-display"></span></p>
      <p>Street: <input type="text" class="editable-value" id="street" value="Maruti Housing Colo" onchange="updateDisplay('street')"><span class="display-text" id="street-display"></span></p>
      <p>City: <input type="text" class="editable-value" id="city" value="Gurugram" onchange="updateDisplay('city')"><span class="display-text" id="city-display"></span></p>
      <p>State: <input type="text" class="editable-value" id="state" value="Haryana" onchange="updateDisplay('state')"><span class="display-text" id="state-display"></span></p>
      <p>PinCode: <input type="text" class="editable-value" id="pincode" value="122009" onchange="updateDisplay('pincode')"><span class="display-text" id="pincode-display"></span></p>
    </div>
    <hr class="separator">
    <p>Del. Partner: *GR*</p>
    <p>Customer GSTIN: URP</p>
    <hr class="separator">

    <div class="order-details">
      <p>OrderDate <input type="text" id="order-date" value="18-09-2025 08:33 AM" onchange="updateDisplay('order-date')"><span class="display-text" id="order-date-display"></span></p>
      <p>OrderID# <input type="text" id="order-id" value="17566266490471778A" onchange="updateDisplay('order-id')"><span class="display-text" id="order-id-display"></span></p>
      <p>ShipmentID# <input type="text" id="shipment-id" value="17566266490471778A-01" onchange="updateDisplay('shipment-id')"><span class="display-text" id="shipment-id-display"></span></p>
      <p>Trip : W5 - *** QC ***</p>
      <p>1 km 190 mtr</p>
    </div>
    <hr class="separator">

    <p class="saved">*You have saved Rs <input type="number" id="saved-amount" value="100.00" step="0.01" onchange="updateDisplay('saved-amount')"><span class="display-text" id="saved-amount-display"></span>* </p>
    <div class="invoice-title">
      <p>TAX INVOICE</p>
      <p>Original for Recipient</p>
    </div>

    <div class="bill-info">
      <p>Bill No.: <input type="text" id="bill-no" value="670999339" onchange="updateDisplay('bill-no')"><span class="display-text" id="bill-no-display"></span></p>
      <p>Date: <input type="text" id="bill-date" value="18-09-2025" onchange="updateDisplay('bill-date')"><span class="display-text" id="bill-date-display"></span></p>
      <p>Time: <input type="text" id="bill-time" value="08:33 AM" onchange="updateDisplay('bill-time')"><span class="display-text" id="bill-time-display"></span></p>
      <p>C#60551161              Txn#39</p>
      <p>S#6701                   R#220</p>
    </div>
    <hr class="separator">

    <div class="items-section">
      <div class="add-item">
        <button onclick="addItem()">Add Grocery Item</button>
      </div>
      <table class="items-table" id="items-table">
        <tr>
          <td>HSN</td>
          <td>Net Price</td>
          <td>Qty</td>
          <td class="right">Value</td>
        </tr>
        <tr><td colspan="4">1)CGST@2.50% SGST@2.50% CESS@0.00%</td></tr>
        <tr class="item-row" id="item-row-1">
          <td><input type="text" id="item-hsn-1" value="17011490" onchange="updateItemDisplay(1)"><span class="display-text" id="item-hsn-display-1"></span></td>
          <td><input type="number" id="item-price-1" value="14190.48" step="0.01" onchange="calculateTotals()"></td>
          <td><input type="number" id="item-qty-1" value="1" step="1" onchange="calculateTotals()"></td>
          <td class="right"><span id="item-value-1">14190.48</span></td>
        </tr>
        <tr class="item-row" id="item-desc-1">
          <td colspan="4">
            <input type="text" id="item-name-1" value="Dhampur Sugar 5kg" style="width: 100%;" onchange="updateItemDisplay(1)">
            <span class="display-text" id="item-name-display-1"></span>
          </td>
        </tr>
        <tr class="item-row" id="item-info-1">
          <td colspan="4">
            Item: 1      QTY : <span id="item-qty-display-1">1</span>    <span id="item-value-display-1">14190.48</span>
            <button class="remove-item-btn" onclick="removeItem(1)">Remove</button>
          </td>
        </tr>
      </table>
    </div>

    <div class="totals">
      <p>Total Amount            <span id="total-amount">14900.00</span></p>
      <p>Coupon Disc             <span id="coupon-disc">100.00</span></p>
      <p>Amount Paid Online      <span id="amount-paid">14800.00</span></p>
      <p>{AMT INCL. OF APPLICABLE TAXES}</p>
    </div>
    <hr class="separator">

    <div class="gst-details">
      <p>-GST bill details -Amount (INR)</p>
      <p>GST Taxable   CGST    SGST</p>
      <p>IND Amount</p>
      <p>    CESS      TotalAmt</p>
      <hr style="margin: 2px 0;">
      <table class="gst-table">
        <tr>
          <td class="left">  1</td>
          <td id="gst-taxable">14190.48</td>
          <td id="gst-cgst">354.76</td>
          <td id="gst-sgst">354.76</td>
        </tr>
        <tr>
          <td></td>
          <td id="gst-cess">0.00</td>
          <td id="gst-total">14900.00</td>
          <td></td>
        </tr>
      </table>
      <hr style="margin: 2px 0;">
      <table class="gst-table">
        <tr>
          <td class="left"> T:</td>
          <td id="gst-taxable-total">14190.48</td>
          <td id="gst-cgst-total">354.76</td>
          <td id="gst-sgst-total">354.76</td>
        </tr>
        <tr>
          <td></td>
          <td id="gst-cess-total">0.00</td>
          <td id="gst-total-total">14900.00</td>
          <td></td>
        </tr>
      </table>
    </div>

    <div class="ref-details">
      <p>RefNo#<span id="ref-no"></span></p>
      <p>Tax Invoice#<span id="tax-invoice">670999339</span></p>
      <p>ROne Card Details</p>
      <p>ROne Card No. :730XXXX372</p>
      <p>ROne Bal(Amount):1.61</p>
    </div>
    <hr class="separator">

    <div class="footer">
      <p>* Thank You for Shopping with us *Website: www.relianceretail.com</p>
      <p>Customer Care email - CS@jiomart.com</p>
      <p>Please refer to our Website link</p>
      <p>https://relianceretail.com/privacy-policy.html</p>
      <p>for Privacy Policy</p>
      <p>"Dynamic</p>
      <p>Quick Response (QR) code is made</p>
      <p>available to the Recipient through a digital display"</p>
      <p>Customer Care toll free number- 1800 898 1222</p>
    </div>

    <div class="qr-bottom">
      <p>Shipment ID code</p>
      <canvas id="qr-bottom" class="qr"></canvas>
    </div>
  </div>

  <button class="print-btn" onclick="printInvoice()">Download Invoice as PDF</button>

  <script>
    let itemCount = 1;

    // Generate random order ID and shipment ID
    function generateOrderId() {
      const timestamp = Date.now().toString().slice(-10);
      const random = Math.floor(Math.random() * 1000000).toString().padStart(6, '0');
      return `175${timestamp}${random}A`;
    }

    function updateDisplay(id) {
      const value = document.getElementById(id).value;
      document.getElementById(id + '-display').textContent = value;
      if (id === 'order-id') {
        document.getElementById('shipment-id').value = value + '-01';
        updateDisplay('shipment-id');
      }
    }

    function updateItemDisplay(itemNum) {
      const hsn = document.getElementById(`item-hsn-${itemNum}`).value;
      const name = document.getElementById(`item-name-${itemNum}`).value;
      document.getElementById(`item-hsn-display-${itemNum}`).textContent = hsn;
      document.getElementById(`item-name-display-${itemNum}`).textContent = name;
      calculateTotals();
    }

    function addItem() {
      itemCount++;
      const table = document.getElementById('items-table');
      
      // Insert new item rows
      const row1 = document.createElement('tr');
      row1.className = 'item-row';
      row1.id = `item-row-${itemCount}`;
      row1.innerHTML = `
        <td><input type="text" id="item-hsn-${itemCount}" onchange="updateItemDisplay(${itemCount})"><span class="display-text" id="item-hsn-display-${itemCount}"></span></td>
        <td><input type="number" id="item-price-${itemCount}" step="0.01" onchange="calculateTotals()"></td>
        <td><input type="number" id="item-qty-${itemCount}" step="1" onchange="calculateTotals()"></td>
        <td class="right"><span id="item-value-${itemCount}"></span></td>
      `;
      
      const row2 = document.createElement('tr');
      row2.className = 'item-row';
      row2.id = `item-desc-${itemCount}`;
      row2.innerHTML = `<td colspan="4"><input type="text" id="item-name-${itemCount}" style="width: 100%;" onchange="updateItemDisplay(${itemCount})"><span class="display-text" id="item-name-display-${itemCount}"></span></td>`;
      
      const row3 = document.createElement('tr');
      row3.className = 'item-row';
      row3.id = `item-info-${itemCount}`;
      row3.innerHTML = `<td colspan="4">Item: ${itemCount}      QTY : <span id="item-qty-display-${itemCount}"></span>    <span id="item-value-display-${itemCount}"></span><button class="remove-item-btn" onclick="removeItem(${itemCount})">Remove</button></td>`;
      
      // Insert before the totals section
      const totalsSection = document.querySelector('.totals');
      const itemsSection = document.querySelector('.items-section');
      table.appendChild(row1);
      table.appendChild(row2);
      table.appendChild(row3);
      
      calculateTotals();
    }

    function removeItem(itemNum) {
      if (itemCount <= 1) {
        alert("At least one item is required");
        return;
      }
      
      document.getElementById(`item-row-${itemNum}`).remove();
      document.getElementById(`item-desc-${itemNum}`).remove();
      document.getElementById(`item-info-${itemNum}`).remove();
      
      // Recalculate item numbers
      const items = document.querySelectorAll('.item-row');
      let newItemCount = 0;
      
      for (let i = 0; i < items.length; i += 3) {
        newItemCount++;
        const itemRow = items[i];
        const itemDesc = items[i+1];
        const itemInfo = items[i+2];
        
        if (itemRow && itemDesc && itemInfo) {
          // Update IDs
          itemRow.id = `item-row-${newItemCount}`;
          itemDesc.id = `item-desc-${newItemCount}`;
          itemInfo.id = `item-info-${newItemCount}`;
          
          // Update input IDs and event handlers
          const hsnInput = itemRow.querySelector('input[type="text"]');
          const priceInput = itemRow.querySelector('input[type="number"]:nth-child(2)');
          const qtyInput = itemRow.querySelector('input[type="number"]:nth-child(3)');
          const nameInput = itemDesc.querySelector('input[type="text"]');
          const removeBtn = itemInfo.querySelector('.remove-item-btn');
          
          if (hsnInput) {
            hsnInput.id = `item-hsn-${newItemCount}`;
            hsnInput.setAttribute('onchange', `updateItemDisplay(${newItemCount})`);
          }
          
          if (priceInput) {
            priceInput.id = `item-price-${newItemCount}`;
            priceInput.setAttribute('onchange', 'calculateTotals()');
          }
          
          if (qtyInput) {
            qtyInput.id = `item-qty-${newItemCount}`;
            qtyInput.setAttribute('onchange', 'calculateTotals()');
          }
          
          if (nameInput) {
            nameInput.id = `item-name-${newItemCount}`;
            nameInput.setAttribute('onchange', `updateItemDisplay(${newItemCount})`);
          }
          
          if (removeBtn) {
            removeBtn.setAttribute('onclick', `removeItem(${newItemCount})`);
          }
          
          // Update display elements
          const hsnDisplay = itemRow.querySelector('.display-text');
          const nameDisplay = itemDesc.querySelector('.display-text');
          const qtyDisplay = itemInfo.querySelector('span:nth-child(1)');
          const valueDisplay = itemInfo.querySelector('span:nth-child(2)');
          
          if (hsnDisplay) hsnDisplay.id = `item-hsn-display-${newItemCount}`;
          if (nameDisplay) nameDisplay.id = `item-name-display-${newItemCount}`;
          if (qtyDisplay) qtyDisplay.id = `item-qty-display-${newItemCount}`;
          if (valueDisplay) valueDisplay.id = `item-value-display-${newItemCount}`;
          
          // Update item info text
          const itemInfoText = itemInfo.querySelector('td');
          if (itemInfoText) {
            itemInfoText.innerHTML = `Item: ${newItemCount}      QTY : <span id="item-qty-display-${newItemCount}"></span>    <span id="item-value-display-${newItemCount}"></span><button class="remove-item-btn" onclick="removeItem(${newItemCount})">Remove</button>`;
          }
        }
      }
      
      itemCount = newItemCount;
      calculateTotals();
    }

    function calculateTotals() {
      let total = 0;
      for (let i = 1; i <= itemCount; i++) {
        const price = parseFloat(document.getElementById(`item-price-${i}`)?.value) || 0;
        const qty = parseInt(document.getElementById(`item-qty-${i}`)?.value) || 0;
        const value = price * qty;
        if (document.getElementById(`item-value-${i}`)) {
          document.getElementById(`item-value-${i}`).textContent = value.toFixed(2);
        }
        if (document.getElementById(`item-qty-display-${i}`)) {
          document.getElementById(`item-qty-display-${i}`).textContent = qty;
        }
        if (document.getElementById(`item-value-display-${i}`)) {
          document.getElementById(`item-value-display-${i}`).textContent = value.toFixed(2);
        }
        total += value;
      }
      
      const savedAmount = parseFloat(document.getElementById('saved-amount').value) || 0;
      const amountPaid = total - savedAmount > 0 ? total - savedAmount : 0;
      document.getElementById('total-amount').textContent = total.toFixed(2);
      document.getElementById('coupon-disc').textContent = savedAmount.toFixed(2);
      document.getElementById('amount-paid').textContent = amountPaid.toFixed(2);

      // Tax calculation (5% GST = 2.5% CGST + 2.5% SGST, 0% CESS)
      const taxable = total / 1.05; // Reverse calculate taxable amount
      const cgst = taxable * 0.025;
      const sgst = taxable * 0.025;
      const cess = 0.00;
      const grandTotal = taxable + cgst + sgst + cess;

      document.getElementById('gst-taxable').textContent = taxable.toFixed(2);
      document.getElementById('gst-cgst').textContent = cgst.toFixed(2);
      document.getElementById('gst-sgst').textContent = sgst.toFixed(2);
      document.getElementById('gst-cess').textContent = cess.toFixed(2);
      document.getElementById('gst-total').textContent = grandTotal.toFixed(2);

      document.getElementById('gst-taxable-total').textContent = taxable.toFixed(2);
      document.getElementById('gst-cgst-total').textContent = cgst.toFixed(2);
      document.getElementById('gst-sgst-total').textContent = sgst.toFixed(2);
      document.getElementById('gst-cess-total').textContent = cess.toFixed(2);
      document.getElementById('gst-total-total').textContent = grandTotal.toFixed(2);

      // Random RefNo# generation
      const randomRefNo = `670${Math.floor(Math.random() * 1000000000000000).toString().padStart(15, '0')}`;
      document.getElementById('ref-no').textContent = randomRefNo;

      document.getElementById('bill-no').value = `670${Math.floor(Math.random() * 1000000).toString().padStart(6, '0')}`;
      updateDisplay('bill-no');
      document.getElementById('tax-invoice').textContent = document.getElementById('bill-no').value;

      let orderId = document.getElementById('order-id').value;
      if (!orderId || orderId === '17566266490471778A') {
        orderId = generateOrderId();
        document.getElementById('order-id').value = orderId;
      }
      updateDisplay('order-id');
      QRCode.toCanvas(document.getElementById('qr-top'), orderId, { width: 60 });
      document.getElementById('shipment-id').value = orderId + '-01';
      updateDisplay('shipment-id');
      QRCode.toCanvas(document.getElementById('qr-bottom'), document.getElementById('shipment-id').value, { width: 60 });
    }

    function printInvoice() {
      calculateTotals();
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: [80, 200]
      });

      const content = document.getElementById('invoice').innerHTML;
      doc.html(content, {
        callback: function (doc) {
          doc.save('JioMart_Invoice_' + new Date().toISOString().split('T')[0] + '.pdf');
        },
        x: 0,
        y: 0,
        width: 80,
        windowWidth: 80
      });
    }

    document.getElementById('saved-amount').addEventListener('input', calculateTotals);

    window.onload = () => {
      // Generate new order ID and shipment ID on page load
      const newOrderId = generateOrderId();
      document.getElementById('order-id').value = newOrderId;
      document.getElementById('shipment-id').value = newOrderId + '-01';
      
      calculateTotals();
      updateDisplay('customer-name');
      updateDisplay('phone');
      updateDisplay('flat-no');
      updateDisplay('street');
      updateDisplay('city');
      updateDisplay('state');
      updateDisplay('pincode');
      updateDisplay('order-date');
      updateDisplay('order-id');
      updateDisplay('shipment-id');
      updateDisplay('saved-amount');
      updateDisplay('bill-no');
      updateDisplay('bill-date');
      updateDisplay('bill-time');
      updateItemDisplay(1);
    };
  </script>
</body>
</html>
